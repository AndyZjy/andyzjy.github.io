<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Lerna初探 | Jerome Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1、简介 首先是关于Monorepo（一篇不错的介绍Monorepo的文章），它是管理项目代码的一种方式，主要手段是通过在一个项目仓库中管理多个模块&#x2F;仓库包。而Multirepo是传统的仓库管理方法，也是公司目前所用的方法，即所有的项目包都是独立仓库部署和管理。两种方式对比如下：  两种方式进行对比的话，千人千面。前者允许多元化发展（各项目可以有自己的构建工具、依赖管理策略、单元测试方法），后者希">
<meta property="og:type" content="article">
<meta property="og:title" content="Lerna初探">
<meta property="og:url" content="http://example.com/2020/11/11/lerna/index.html">
<meta property="og:site_name" content="Jerome Blog">
<meta property="og:description" content="1、简介 首先是关于Monorepo（一篇不错的介绍Monorepo的文章），它是管理项目代码的一种方式，主要手段是通过在一个项目仓库中管理多个模块&#x2F;仓库包。而Multirepo是传统的仓库管理方法，也是公司目前所用的方法，即所有的项目包都是独立仓库部署和管理。两种方式对比如下：  两种方式进行对比的话，千人千面。前者允许多元化发展（各项目可以有自己的构建工具、依赖管理策略、单元测试方法），后者希">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/12/14/qIkHoXFuGaSBzpE.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/Nxs1u5qekmlpfaV.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/fgDnMYGpBaOshmz.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/s1ohqu25WKU8IYJ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/pNdEtX7iRUBDcov.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/1YjZaQOxybGetuL.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/D7JtfOQ29W48MzZ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/vZLXAODugqNrK2Y.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/8UeDy4ZrJjOC7Qc.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/wN4nbc3eE9FPxQd.png">
<meta property="og:image" content="https://i.loli.net/2020/12/14/Z5IvyVpUrJ9skWR.png">
<meta property="article:published_time" content="2020-11-11T07:00:55.000Z">
<meta property="article:modified_time" content="2020-12-14T02:43:07.659Z">
<meta property="article:author" content="Jerome Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/12/14/qIkHoXFuGaSBzpE.png">
  
    <link rel="alternative" href="/atom.xml" title="Jerome Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85415703-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://i.loli.net/2020/12/11/tGqjVXEf9b6rM1H.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/AndyZjy" title="github">github</a>
					        
								<a class="mail" target="_blank" href="/15966685680@163.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://i.loli.net/2020/12/11/tGqjVXEf9b6rM1H.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/AndyZjy" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/15966685680@163.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-lerna" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/11/11/lerna/" class="article-date">
  	<time datetime="2020-11-11T07:00:55.000Z" itemprop="datePublished">2020-11-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Lerna初探
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="BPMpI" data-lake-id="12b37c98fbf87cd914e80d6823b95196">1、简介</h3>
<p data-lake-id="8e82672f1862e940f4e324455cafdf08">首先是关于Monorepo（<a href="https://zhuanlan.zhihu.com/p/77577415" target="_blank">一篇不错的介绍Monorepo的文章</a>），它是管理项目代码的一种方式，主要手段是通过在一个项目仓库中管理多个模块/仓库包。而Multirepo是传统的仓库管理方法，也是公司目前所用的方法，即所有的项目包都是独立仓库部署和管理。两种方式对比如下：</p>
<p data-lake-id="59543dc7a0fcad8d1445ca5a51269018" style="text-align: center"><img src="https://i.loli.net/2020/12/14/qIkHoXFuGaSBzpE.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="495px" /></p>
<p data-lake-id="2a937bd70eb1fc66784e682ebd14b5fd">两种方式进行对比的话，千人千面。前者允许多元化发展（各项目可以有自己的构建工具、依赖管理策略、单元测试方法），后者希望集中管理，减少项目间的差异带来的沟通成本。</p>
<p data-lake-id="cd3a332f22d784bfc474ef20f593408e">虽然拆分子仓库、拆分子 npm 包是进行项目隔离的天然方案，但当仓库内容出现关联时，没有任何一种调试方式比源码放在一起更高效。</p>
<p data-lake-id="6273c882c1b10cd1c30a245e9c10effd">在前端开发环境中，多 Git Repo，多 npm 则是这个理想的阻力，它们导致复用要关心版本号，调试需要 npm link。而这些是 MonoRepo 最大的优势。</p>
<p data-lake-id="84c330999beda36dee9006e665b1a98c">上图中提到的利用相关工具就是今天的主角 Lerna ! Lerna是业界知名度最高的 Monorepo 管理工具，功能完整。而且目前很多大型开源项目都采用了这种方式，比如Babel、React、Meteor、Ember、Jest、Vue等等，当我们查看他们的源码时，可以发现他们的目录都是将主要内容放在packages目录中，分多个模块进行管理。</p>
<h3 id="jU77r" data-lake-id="f2a881389188e92743b5ffba2c3ab97d">2、使用</h3>
<h4 id="HkgxL" data-lake-id="990af1c365fa11610f0aadb9544ef999">2.1、全局安装Lerna</h4>
<div id="OoNGd" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22npm%20install%20lerna%20-g%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22OoNGd%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content"><span class="cm-builtin">npm install lerna <span class="cm-attribute">-g</span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="d1233715fc463fafba2fe79843e03a7d">或者</p>
<div id="lWntQ" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22yarn%20add%20lerna%20-D%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22lWntQ%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">yarn add lerna <span class="cm-attribute">-D</span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="1f07df865af6dbab8ca291677adf9135">安装完成后，在控制台输入lerna -v，只要可以显示版本号，就意味着我们安装成功了。控制台输出如下图：</p>
<p data-lake-id="231fcaa2a360ed995d14c397fdb4b8ae" style="text-align: center"><img src="https://i.loli.net/2020/12/14/Nxs1u5qekmlpfaV.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="104px" /></p>
<h4 id="b368R" data-lake-id="8ff2cdec5fc93a98d0af7ede67aa6bbc">2.2、初始化</h4>
<p data-lake-id="3fb18b6b920bd84b3d87c62a8e4f1785">初始化之前的步骤无非两种，第一种是创建一个lerna-repo目录，第二种是在git上创建一个项目lerna-repo并clone到本地，然后本地进入该目录并执行</p>
<div id="gjJTb" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22npx%20lerna%20init%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22gjJTb%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">npx lerna init</span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="3fea212cf77b64ea3d961e18d7d78bd4">一开始我们都是使用lerna的默认模式我们的目录结构会变成如下：</p>
<p data-lake-id="79d2ba6f04ab2ec4b97f57510d542890" style="text-align: center"><img src="https://i.loli.net/2020/12/14/fgDnMYGpBaOshmz.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="116px" /></p>
<p data-lake-id="841d2081e0542459ee78e0f1bea7b423">顾名思义，lerna.json就是Lerna的配置文件，里面可以进行不同的业务或者不同的场景的配置话定义，我们可以查看初始化的lerna.json的文件，如下图：</p>
<p data-lake-id="49ef5bc36bd063c5449e46ffee523487" style="text-align: center"><img src="https://i.loli.net/2020/12/14/s1ohqu25WKU8IYJ.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="235px" /></p>
<p data-lake-id="5ec4f70c61ff1685fe86ab32b776e074">首先就是packages属性，它的类型是一个数组，在这里可以配置可以发布的npm包的目录，可以根据不同的场景进行定义发布的npm包所在的不同的文件夹。其次的属性version就是当前lerna项目的版本号。</p>
<h4 id="qQPHx" data-lake-id="5e8bde3ea1ecda45ec65f5795fef8609">2.3、引入npm包/生成一个npm包</h4>
<p data-lake-id="36588a5dbd9b304981299b78c66e6916">这里不得不介绍一下引入npm包的强大之处，它可以把你引入的包的git commit记录完整的引入。我们一般都是先将要引入的包下载到本地，命令如下：</p>
<div id="9jM8u" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20import%20..%2Fuserlogin%20%20%20%22%2C%22margin%22%3Atrue%2C%22id%22%3A%229jM8u%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna import ../userlogin   </span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="49f4cc326985fb8b8d00bba20416c6dc">如果是新项目，需要新生成一个npm包的话，可以使用如下命令lerna create &lt;包名&gt; [目录]：</p>
<div id="6AVNH" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20create%20base%20packages%2Fnpm%20%22%2C%22margin%22%3Atrue%2C%22id%22%3A%226AVNH%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna create base packages/npm </span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="838f3b96ebfc9e9348c2014b5054b963"><span class="lake-fontsize-10">ps:此处npm为原有目录；</span></p>
<p data-lake-id="2abdeebc3148da93d5b37ffd13427d7b">引入一个npm包其实还可以通过进入当前packages文件夹下，通过git clone的方式进行引入，这种优点是可以自由的在某一个项目中进行切换分支，如果是import的方式引入的npm包，目前我是没找到自由切换单项目分支的方式，欢迎大家补充。<span class="lake-fontsize-10"><br /></p>
<p data-lake-id="e65b89affd6062ead93a75698b97cd2e">create时，按照lerna的提示输入name、version等属性就好了，如果为了省事可以一路回车走到最后，它就会以默认值的形式生成一个新的npm包。</p>
<p data-lake-id="2482c8de149714cbe98cb796b48e03de">无论是引入的npm包，还是生成的npm包，默认目录都是在当前项目根目录下的packages文件夹下，生成的目录如下：</p>
<p data-lake-id="a617d27acccd4ae98e59a5be1657e098" style="text-align: center"><img src="https://i.loli.net/2020/12/14/pNdEtX7iRUBDcov.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="159px" /></p>
<p data-lake-id="8fedd3e16dfc67abb09c749d438a8bfa">此处会有几种常见的错误展示，第一种就是由于你是新建的lerna项目，没有进行git commit，这时候进行lerna import会报错如下：</p>
<div id="iVwr6" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22Error%3A%20Command%20failed%3A%20git%20rev-parse%20HEAD%5Cnlerna%20ERR!%20fatal%3A%20ambiguous%20argument%20'HEAD'%3A%20unknown%20revision%20or%20path%20not%20in%20the%20working%20tree.%5Cnlerna%20ERR!%20Use%20'--'%20to%20separate%20paths%20from%20revisions%2C%20like%20this%3A%5Cnlerna%20ERR!%20'git%20%3Ccommand%3E%20%5B%3Crevision%3E...%5D%20--%20%5B%3Cfile%3E...%5D'%5Cnlerna%20ERR!%20%5Cnlerna%20ERR!%20HEAD%5Cnlerna%20ERR!%20%5Cnlerna%20ERR!%20at%20makeError%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2Fexeca%2Findex.js%3A174%3A9)%5Cnlerna%20ERR!%20at%20Function.module.exports.sync%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2Fexeca%2Findex.js%3A338%3A15)%5Cnlerna%20ERR!%20at%20Object.execSync%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fchild-process%2Findex.js%3A22%3A16)%5Cnlerna%20ERR!%20at%20ImportCommand.getCurrentSHA%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fimport%2Findex.js%3A129%3A34)%5Cnlerna%20ERR!%20at%20ImportCommand.initialize%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fimport%2Findex.js%3A98%3A31)%5Cnlerna%20ERR!%20at%20Promise.resolve.then%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fcommand%2Findex.js%3A266%3A24)%5Cnlerna%20ERR!%20at%20%3Canonymous%3E%5Cnlerna%20ERR!%20lerna%20Command%20failed%3A%20git%20rev-parse%20HEAD%5Cnlerna%20ERR!%20lerna%20fatal%3A%20ambiguous%20argument%20'HEAD'%3A%20unknown%20revision%20or%20path%20not%20in%20the%20working%20tree.%5Cnlerna%20ERR!%20lerna%20Use%20'--'%20to%20separate%20paths%20from%20revisions%2C%20like%20this%3A%5Cnlerna%20ERR!%20lerna%20'git%20%3Ccommand%3E%20%5B%3Crevision%3E...%5D%20--%20%5B%3Cfile%3E...%5D'%5Cnlerna%20ERR!%20lerna%20%5Cnlerna%20ERR!%20lerna%20HEAD%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22iVwr6%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">Error: Command failed: <span class="cm-builtin">git rev-parse HEAD
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! fatal: ambiguous argument <span class="cm-string">'HEAD': unknown revision or path not <span class="cm-keyword">in the working tree.
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! Use <span class="cm-string">'--' to separate paths from revisions, like this:
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! <span class="cm-string">'git &lt;command&gt; [&lt;revision&gt;...] -- [&lt;file&gt;...]'
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! 
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! HEAD
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! 
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! at makeError (/usr/local/lib/node_modules/lerna/node_modules/execa/index.js:174:9)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! at Function.module.exports.sync (/usr/local/lib/node_modules/lerna/node_modules/execa/index.js:338:15)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at Object.execSync (/usr/local/lib/node_modules/lerna/node_modules/@lerna/child-process/index.js:22:16)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at ImportCommand.getCurrentSHA (/usr/local/lib/node_modules/lerna/node_modules/@lerna/import/index.js:129:34)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at ImportCommand.initialize (/usr/local/lib/node_modules/lerna/node_modules/@lerna/import/index.js:98:31)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at Promise.resolve.then (/usr/local/lib/node_modules/lerna/node_modules/@lerna/command/index.js:266:24)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at &lt;anonymous&gt;
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna Command failed: <span class="cm-builtin">git rev-parse HEAD
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna fatal: ambiguous argument <span class="cm-string">'HEAD': unknown revision or path not <span class="cm-keyword">in the working tree.
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna Use <span class="cm-string">'--' to separate paths from revisions, like this:
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna <span class="cm-string">'git &lt;command&gt; [&lt;revision&gt;...] -- [&lt;file&gt;...]'
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna 
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna HEAD</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="88380c1dc21c77a21fc8423465f64203">如果你没有初始化git项目的话，会有如下报错：</p>
<div id="9fwj9" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22cli%20v3.8.0%5Cnlerna%20ERR!%20Error%3A%20Command%20failed%3A%20git%20log%20--format%3D%25h%5Cnlerna%20ERR!%20fatal%3A%20Not%20a%20git%20repository%20(or%20any%20of%20the%20parent%20directories)%3A%20.git%5Cnlerna%20ERR!%20%5Cnlerna%20ERR!%20%5Cnlerna%20ERR!%20at%20makeError%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2Fexeca%2Findex.js%3A174%3A9)%5Cnlerna%20ERR!%20at%20Function.module.exports.sync%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2Fexeca%2Findex.js%3A338%3A15)%5Cnlerna%20ERR!%20at%20Object.execSync%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fchild-process%2Findex.js%3A22%3A16)%5Cnlerna%20ERR!%20at%20ImportCommand.externalExecSync%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fimport%2Findex.js%3A137%3A34)%5Cnlerna%20ERR!%20at%20ImportCommand.initialize%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fimport%2Findex.js%3A82%3A25)%5Cnlerna%20ERR!%20at%20Promise.resolve.then%20(%2Fusr%2Flocal%2Flib%2Fnode_modules%2Flerna%2Fnode_modules%2F%40lerna%2Fcommand%2Findex.js%3A266%3A24)%5Cnlerna%20ERR!%20at%20%3Canonymous%3E%5Cnlerna%20ERR!%20lerna%20Command%20failed%3A%20git%20log%20--format%3D%25h%5Cnlerna%20ERR!%20lerna%20fatal%3A%20Not%20a%20git%20repository%20(or%20any%20of%20the%20parent%20directories)%3A%20.git%5Cnlerna%20ERR!%20lerna%20%22%2C%22margin%22%3Atrue%2C%22id%22%3A%229fwj9%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">cli v3.8.0
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! Error: Command failed: <span class="cm-builtin">git log <span class="cm-attribute">--format<span class="cm-operator">=%h
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! fatal: Not a <span class="cm-builtin">git repository (or any of the parent directories): .git
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! 
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! 
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! at makeError (/usr/local/lib/node_modules/lerna/node_modules/execa/index.js:174:9)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! at Function.module.exports.sync (/usr/local/lib/node_modules/lerna/node_modules/execa/index.js:338:15)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! at Object.execSync (/usr/local/lib/node_modules/lerna/node_modules/@lerna/child-process/index.js:22:16)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! at ImportCommand.externalExecSync (/usr/local/lib/node_modules/lerna/node_modules/@lerna/import/index.js:137:34)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at ImportCommand.initialize (/usr/local/lib/node_modules/lerna/node_modules/@lerna/import/index.js:82:25)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at Promise.resolve.then (/usr/local/lib/node_modules/lerna/node_modules/@lerna/command/index.js:266:24)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! at &lt;anonymous&gt;
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna Command failed: <span class="cm-builtin">git log <span class="cm-attribute">--format<span class="cm-operator">=%h
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna fatal: Not a <span class="cm-builtin">git repository (or any of the parent directories): .git
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! lerna </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="8d503fd1d4050e282f5e13e786e7a09a">但是如果原项目是具有合并提交冲突的存储库时，import命令便无法尝试应用所有提交。此时可以使用 --flatten命令标志来请求导入固定的历史记录，也就是将每次合并提交作为单独的更改，引入合并。报错如下：</p>
<div id="NnklF" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22plain%22%2C%22code%22%3A%22lerna%20ERR!%20import%20Rolling%20back%20to%20previous%20HEAD%20(commit%20e232dec13e7a62943567257eff8573db2eb1a19e)%5Cnlerna%20ERR!%20EIMPORT%20Failed%20to%20apply%20commit%202aafdfd.%5Cnlerna%20ERR!%20EIMPORT%20Command%20failed%3A%20git%20am%20-3%20--keep-non-patch%5Cnlerna%20ERR!%20EIMPORT%20Can't%20find%20Husky%2C%20skipping%20applypatch-msg%20hook%5Cnlerna%20ERR!%20EIMPORT%20You%20can%20reinstall%20it%20using%20'npm%20install%20husky%20--save-dev'%20or%20delete%20this%20hook%5Cnlerna%20ERR!%20EIMPORT%20error%3A%20Failed%20to%20merge%20in%20the%20changes.%5Cnlerna%20ERR!%20EIMPORT%20hint%3A%20Use%20'git%20am%20--show-current-patch'%20to%20see%20the%20failed%20patch%5Cnlerna%20ERR!%20EIMPORT%20Applying%3A%20feat(component)%3A%20add%20chromeDownload%20component%5Cnlerna%20ERR!%20EIMPORT%20Using%20index%20info%20to%20reconstruct%20a%20base%20tree...%5Cnlerna%20ERR!%20EIMPORT%20M%20%20%20%20packages%2Fdt-react-component%2F.storybook%2Fconfig.js%5Cnlerna%20ERR!%20EIMPORT%20Falling%20back%20to%20patching%20base%20and%203-way%20merge...%5Cnlerna%20ERR!%20EIMPORT%20Auto-merging%20packages%2Fdt-react-component%2F.storybook%2Fconfig.js%5Cnlerna%20ERR!%20EIMPORT%20CONFLICT%20(content)%3A%20Merge%20conflict%20in%20packages%2Fdt-react-component%2F.storybook%2Fconfig.js%5Cnlerna%20ERR!%20EIMPORT%20Patch%20failed%20at%200001%20feat(component)%3A%20add%20chromeDownload%20component%5Cnlerna%20ERR!%20EIMPORT%20When%20you%20have%20resolved%20this%20problem%2C%20run%20%5C%22git%20am%20--continue%5C%22.%5Cnlerna%20ERR!%20EIMPORT%20If%20you%20prefer%20to%20skip%20this%20patch%2C%20run%20%5C%22git%20am%20--skip%5C%22%20instead.%5Cnlerna%20ERR!%20EIMPORT%20To%20restore%20the%20original%20branch%20and%20stop%20patching%2C%20run%20%5C%22git%20am%20--abort%5C%22.%5Cnlerna%20ERR!%20EIMPORT%20%5Cnlerna%20ERR!%20EIMPORT%20%5Cnlerna%20ERR!%20EIMPORT%20You%20may%20try%20again%20with%20--flatten%20to%20import%20flat%20history.%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22NnklF%22%7D" data-language="plain">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! import Rolling back to previous HEAD (commit e232dec13e7a62943567257eff8573db2eb1a19e)
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Failed to apply commit 2aafdfd.
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Command failed: git am -3 --keep-non-patch
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Can't find Husky, skipping applypatch-msg hook
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT You can reinstall it using 'npm install husky --save-dev' or delete this hook
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT error: Failed to merge in the changes.
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT hint: Use 'git am --show-current-patch' to see the failed patch
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Applying: feat(component): add chromeDownload component
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Using index info to reconstruct a base tree...
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT M    packages/dt-react-component/.storybook/config.js
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Falling back to patching base and 3-way merge...
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Auto-merging packages/dt-react-component/.storybook/config.js
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT CONFLICT (content): Merge conflict in packages/dt-react-component/.storybook/config.js
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT Patch failed at 0001 feat(component): add chromeDownload component
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT When you have resolved this problem, run "git am --continue".
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT If you prefer to skip this patch, run "git am --skip" instead.
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT To restore the original branch and stop patching, run "git am --abort".
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT 
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT 
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna ERR! EIMPORT You may try again with --flatten to import flat history.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="705e144739128cf9ed56da0007b86597">命令如下：</p>
<div id="wkGAJ" class="lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22%24%20lerna%20import%20..%2Fbase%20--flatten%22%2C%22id%22%3A%22wkGAJ%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content"><span class="cm-def">$ lerna import ../base <span class="cm-attribute">--flatten</span></span></span></span></span></pre>
</div>
</div>
</div>
<h4 id="CUsN7" data-lake-id="36a8b6fc865649cf490d01d03e4438b4">2.4、显示当前列表</h4>
<div id="JTNFR" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20list%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22JTNFR%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna list</span></span></span></pre>
</div>
</div>
</div>
<h4 id="BgccG" data-lake-id="53c4e03b4edcea329787c0214f6fed6a">2.5、 为项目包添加依赖</h4>
<p data-lake-id="b4f0ab10411e31c557dcefc2a99dc1fd">命令格式：</p>
<div id="90WzV" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20add%20%E5%8C%85%E5%90%8D%20%5B--scope%3D%E7%89%B9%E5%AE%9A%E7%9A%84%E6%9F%90%E4%B8%AA%E5%8C%85%5D%22%2C%22margin%22%3Atrue%2C%22id%22%3A%2290WzV%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna add 包名 <span class="cm-def">[--scope<span class="cm-operator">=特定的某个包]</span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="a04be26de522275bc6ec0a5063448f21">例子：</p>
<div id="eEj31" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20add%20component%20--scope%3Dbase%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22eEj31%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna add component <span class="cm-attribute">--scope<span class="cm-operator">=base</span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="d87931fa85ce20654ebaec8c1e26b635">如上面例子代码，执行成功这段代码后，我们可以在base项目中引用component的包了，而且会自动把component包的版本号更新到base包的package.json中。此处需要注意，如果我们add的包不在我们的packages目录下，它就会自动从npm的仓库上进行下载，并且因为加了scope，所以只会给base包进行安装依赖，如果不加scope这段代码的话，会自动给packages目录下所有的包更新安装component依赖。如果原项目中在package.json中有当前npm包的配置，那么这行命令会将原配置删除，并新增当前最新版本的npm包，保证其的版本实时性。</p>
<h4 id="y11mW" data-lake-id="b36f3a2da00a6927e6d51ae6401a44e4">2.6、为每个包安装依赖</h4>
<div id="Ooulc" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20bootstrap%20--scope%3D%E7%89%B9%E5%AE%9A%E7%9A%84%E6%9F%90%E4%B8%AA%E5%8C%85%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22Ooulc%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna bootstrap <span class="cm-attribute">--scope<span class="cm-operator">=特定的某个包</span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="70842d493533e280f1ed570529a3b5cb">这行代码功能和npm install或者yarn差不多，如果不加后缀scope，lerna会自动把当前工程下的所有包的依赖都安装好。</p>
<p data-lake-id="6a05fb8f093f58991d80def42b0168af">请注意，Lerna在这有一个非常强大的功能，</p>
<h4 id="Iv1kd" data-lake-id="91d1e2346e98362f930686aced58fe76">2.7、删除某个包的依赖</h4>
<div id="Cfk3K" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20clean%20--scope%3D%E7%89%B9%E5%AE%9A%E7%9A%84%E6%9F%90%E4%B8%AA%E5%8C%85%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22Cfk3K%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna clean <span class="cm-attribute">--scope<span class="cm-operator">=特定的某个包</span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="662aa1f80002246097e1e45a8a9aa0f0">同安装依赖，这行代码就是删除某个包的依赖，跟rm -rf node_modules功能一致，将某个项目的node_modules删除，如果不加scope，就会默认删除全部项目的依赖，如下图，会出现提示：</p>
<h4 id="YZOrH" data-lake-id="19e3f52e9380bce90431618de30d0f23" style="text-align: center"><img src="https://i.loli.net/2020/12/14/1YjZaQOxybGetuL.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="103px" /></h4>
<h4 id="pw5ji" data-lake-id="1941f57d4f599ba59cc30f16d9a3faa8">2.8、运行项目中的script命令</h4>
<div id="ScJhL" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20run%20%E5%91%BD%E4%BB%A4%20--scope%3D%E7%89%B9%E5%AE%9A%E7%9A%84%E6%9F%90%E4%B8%AA%E5%8C%85%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22ScJhL%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna run 命令 <span class="cm-attribute">--scope<span class="cm-operator">=特定的某个包</span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="af6db61c247e79480738eb8cb605cc8b">这里可以运行start等约定好的script命令，同理，如果没有scope后缀，lerna会运行每个包的该script命令，截图如下：</p>
<p data-lake-id="fb41c11876530da3fa4e81eed7b29e30" style="text-align: center"><img src="https://i.loli.net/2020/12/14/D7JtfOQ29W48MzZ.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="67px" /></p>
<h4 id="XZSln" data-lake-id="15c5a0d40bc5d31dab1c5142703b1220">2.9、查看可以发布的包</h4>
<div id="gMn6T" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20changed%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22gMn6T%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna changed</span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="25177b5c1f5af547e2c20f2930866867">该命令是查看当前可以发布的包，<span class="lake-fontsize-12">显示自上次relase tag以来有修改的包，输入后展示图会与下图类似：</span></p>
<p data-lake-id="cfad7ff3917f4ef614d8fa69dc4222d8" style="text-align: center"><img src="https://i.loli.net/2020/12/14/vZLXAODugqNrK2Y.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="110px" /></p>
<p data-lake-id="180490bc83301185c4f326c60419f362">如图展示，当前有三个包可以进行发布，但是如果你发布完以后再执行该命令，此处就会展示No changed packages found。</p>
<h4 id="jFxYC" data-lake-id="49b3e12a2c2710d2acd256d6d84b1dc3">2.10、发布某个项目</h4>
<div id="rbHwc" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20publish%20--dist-tag%3Dtag%E5%90%8D%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22rbHwc%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna publish <span class="cm-attribute">--dist<span class="cm-attribute">-tag<span class="cm-operator">=tag名</span></span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="e0aacef6659f4170b0e884d470950791">输入该命令后，会展示如下图：</p>
<p data-lake-id="f6a50c2f4d533d94c3cff81dc2a702df" style="text-align: center"><img src="https://i.loli.net/2020/12/14/8UeDy4ZrJjOC7Qc.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="189px" /></p>
<p data-lake-id="71b132a5d0b1c7fb9c63dad1a1f86a48">在上图中，控制台会让用户选择要发布的版本的版本号，最后一个选项为自定义选项。--dist-tag=tag名为发布某一个分支的包，主要用于测试或者多版本并存的情况。发布模式如下图：</p>
<p data-lake-id="4ce3de762ced0980c54f453ba3a7049c" style="text-align: center"><img src="https://i.loli.net/2020/12/14/wN4nbc3eE9FPxQd.png" alt="image.png" class="image lake-drag-image" title="image.png" data-role="image" data-raw-src="" data-height="383px" /></p>
<h4 id="W3Csg" data-lake-id="c4fc8b733d1516862827396aeb3fe8f0">2.11、查看diff</h4>
<div id="nW2ZT" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20diff%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22nW2ZT%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna <span class="cm-builtin">diff</span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="3ae34d927c8bd660db469ec533b2d748">作用类似git diff，主要用于<span class="lake-fontsize-12">显示自上次relase tag以来有修改的包的差异。</span></p>
<h4 id="k0n8V" data-lake-id="b2aabf72b78e424b3732be4d18dbda23">2.12、链接引用</h4>
<div id="6pryt" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22lerna%20link%22%2C%22margin%22%3Atrue%2C%22id%22%3A%226pryt%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">lerna link</span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="38a30f6d12e4a003192edf37250d4dc2">链接项目引用的库。主要用于项目包建立软链，类似 npm link。</p>
<h4 id="w8E6n" data-lake-id="f7e6cd99ca47260d5f3ef510a2b2abe8">2.13、exec</h4>
<p data-lake-id="10fbc9c93f58bea23937056edb3811d7">在每个包目录下执行任何命令。</p>
<div id="J0HSn" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22bash%22%2C%22code%22%3A%22%24%20lerna%20exec%20--%20%3Ccommand%3E%20%5B..args%5D%20%23%20runs%20the%20command%20in%20all%20packages%5Cn%24%20lerna%20exec%20--%20rm%20-rf%20.%2Fnode_modules%5Cn%24%20lerna%20exec%20--%20protractor%20conf.js%5Cn%24%20lerna%20exec%20--%20npm%20view%20%5C%5C%24LERNA_PACKAGE_NAME%5Cn%24%20lerna%20exec%20--%20node%20%5C%5C%24LERNA_ROOT_PATH%2Fscripts%2Fsome-script.js%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22J0HSn%22%7D" data-language="bash">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content"><span class="cm-def">$ lerna exec <span class="cm-attribute">-- &lt;command&gt; [..args] <span class="cm-comment"># runs the command in all packages
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content"><span class="cm-def">$ lerna exec <span class="cm-attribute">-- <span class="cm-builtin">rm <span class="cm-attribute">-rf ./node_modules
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content"><span class="cm-def">$ lerna exec <span class="cm-attribute">-- protractor conf.js
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content"><span class="cm-def">$ lerna exec <span class="cm-attribute">-- <span class="cm-builtin">npm view \$LERNA_PACKAGE_NAME
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content"><span class="cm-def">$ lerna exec <span class="cm-attribute">-- <span class="cm-builtin">node \$LERNA_ROOT_PATH/scripts/some-script.js</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
</div>
</div>
<h3 id="1Rkhq" data-lake-id="743fcec6539789bc07863073c9fd14df">3、模式</h3>
<p data-lake-id="97ec0b2b26e4329f144213b5b30b9e85">&nbsp; &nbsp;&nbsp;Lerna提供了两种管理项目的方式，一种是固定模式（Fixed mode），另一种是独立模式（Independent mode），两者区分如下：</p>
<p data-lake-id="3ac25ef55e74617bf59ef89266c3fb71">固定模式下，packages文件夹下的所有包将会公用一个版本号version（这个version就是lerna.json中的version字段），会自动将所有的包绑定到一个版本号上面，当任意一个npm包发生了更新，整个公用版本号就会发生变化。</p>
<p data-lake-id="a2e60b2790b6f666ce204e00f0d1602c">独立模式下，每个npm包都具有一个独立的版本号，在使用发布命令lerna publish命令时，可以为每个包单独的进行发布操作，同时只更新当前包的版本号，不会影响其余包的版本。在此模式下，lerna.json的version字段改为independent即可。</p>
<p data-lake-id="4c1ff7ca8106949aa5e2004b3430e538"><span class="lake-fontsize-12">lerna version&nbsp;会检测从上一个版本发布以来的变动，但有一些文件的提交，我们不希望触发版本的变动，譬如 .md 文件的修改，并没有实际引起 package 逻辑的变化，不应该触发版本的变更。可以通过ignoreChanges<span class="lake-fontsize-12">配置排除，如下：</span></span></p>
<div id="PDbl3" class="lake-card-margin lake-selected" data-card-type="block" data-lake-card="codeblock" data-card-value="data:%7B%22mode%22%3A%22json%22%2C%22code%22%3A%22%7B%5Cn%20%20%5C%22packages%5C%22%3A%20%5B%5Cn%20%20%20%20%5C%22packages%2F*%5C%22%5Cn%20%20%5D%2C%5Cn%20%20%5C%22command%5C%22%3A%20%7B%5Cn%20%20%20%20%5C%22bootstrap%5C%22%3A%20%7B%5Cn%20%20%20%20%20%20%5C%22hoist%5C%22%3A%20true%5Cn%20%20%20%20%7D%2C%5Cn%20%20%20%20%5C%22version%5C%22%3A%20%7B%5Cn%20%20%20%20%20%20%5C%22conventionalCommits%5C%22%3A%20true%5Cn%20%20%20%20%7D%5Cn%20%20%7D%2C%5Cn%20%20%5C%22ignoreChanges%5C%22%3A%20%5B%5Cn%20%20%20%20%5C%22**%2F*.md%5C%22%5Cn%20%20%5D%2C%5Cn%20%20%5C%22version%5C%22%3A%20%5C%220.0.1-alpha.1%5C%22%5Cn%7D%22%2C%22margin%22%3Atrue%2C%22id%22%3A%22PDbl3%22%7D" data-language="json">
<div class="lake-codeblock-content">
<div class="CodeMirror-sizer">
<pre class="cm-s-default"><span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">{
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">  <span class="cm-string cm-property">"packages": [
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">    <span class="cm-string">"packages/*"
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">  ],
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">  <span class="cm-string cm-property">"command": {
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">    <span class="cm-string cm-property">"bootstrap": {
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">      <span class="cm-string cm-property">"hoist": <span class="cm-atom">true
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">    },
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-1"><span class="lake-preview-codeblock-content">    <span class="cm-string cm-property">"version": {
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">      <span class="cm-string cm-property">"conventionalCommits": <span class="cm-atom">true
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">    }
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">  },
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">  <span class="cm-string cm-property">"ignoreChanges": [
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">    <span class="cm-string">"**/*.md"
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">  ],
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">  <span class="cm-string cm-property">"version": <span class="cm-string">"0.0.1-alpha.1"
<span class="lake-preview-line"><span class="lake-preview-line-number lake-lm-pad-level-0"><span class="lake-preview-codeblock-content">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
</div>
</div>
</div>
<p data-lake-id="6e7de78896b6450b13497ff49501d75d">效果如下：</p>
<p data-lake-id="ce58cd9029e6225cdc6daf3e1471a1bf" style="text-align: center"><img src="https://i.loli.net/2020/12/14/Z5IvyVpUrJ9skWR.png" alt="image.png"  title="image.png" data-role="image" data-raw-src="" data-height="349px" class="image lake-drag-image" /></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/12/11/cssFilter/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          CSS色调旋转滤镜
        
      </div>
    </a>
  
  
    <a href="/2020/10/14/cssVar/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">巧妙使用CSS变量</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2020 Jerome Zhang
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>